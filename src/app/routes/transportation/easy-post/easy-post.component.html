<page-header title="{{'easy-post' |  i18n}}" ></page-header>


<nz-spin [nzSpinning]="isSpinning" [nzSize]="'large'">
    <nz-card [nzActions]="[actionConfirm]">        
        <div nz-row [nzGutter]="24"> 
          <div nz-col [nzSpan]="12">
            <nz-form-item>
                <nz-form-label [nzSpan]="6">
                {{ 'apiKey' | i18n }}
                </nz-form-label>
                <nz-form-control [nzSpan]="18">
                    <input nz-input [(ngModel)]="currentEasyPostConfiguration!.apiKey" /> 

                </nz-form-control>
            </nz-form-item>
          </div>   
        </div>
          
        <div nz-row [nzGutter]="24"> 
          <div nz-col [nzSpan]="12">
            <nz-form-item>
                <nz-form-label [nzSpan]="6">
                {{ 'webhookSecret' | i18n }}
                </nz-form-label>

                <nz-form-control [nzSpan]="18">
                    
                    <nz-input-group [nzSuffix]="suffixTemplate">
                        <input [type]="webhookSecretVisible ? 'text' : 'password'" nz-input [(ngModel)]="currentEasyPostConfiguration!.webhookSecret"
                          />
                    </nz-input-group>
                    <ng-template #suffixTemplate>
                        <i nz-icon [nzType]="webhookSecretVisible ? 'eye-invisible' : 'eye'"
                        (click)="webhookSecretVisible = !webhookSecretVisible"></i>
                    </ng-template>
                   

                </nz-form-control>
            </nz-form-item>
          </div>   
        </div>  
        <div nz-row [nzGutter]="24"> 
          <div nz-col [nzSpan]="12">
            <nz-form-item>
                <nz-form-label [nzSpan]="10">
                {{ 'useWarehouseAddressAsShipFromFlag' | i18n }}
                </nz-form-label>
                <nz-form-control [nzSpan]="14"> 
                    <label nz-checkbox [(ngModel)]="currentEasyPostConfiguration!.useWarehouseAddressAsShipFromFlag"></label>

                </nz-form-control>
            </nz-form-item>
          </div>   
        </div>
        <!--If not use the warehouse's address, allow the user to type in a adddress that will show up in the parcel label -->
        
        <nz-card *ngIf="!currentEasyPostConfiguration!.useWarehouseAddressAsShipFromFlag" nzTitle="{{'shipFromAddress' | i18n}}">


          <div nz-row [nzGutter]="24" *ngIf="!currentEasyPostConfiguration!.useWarehouseAddressAsShipFromFlag"> 
           
              <div nz-col [nzSpan]="8">
                <nz-form-item nzFlex>
                  <nz-form-label [nzSpan]="8">
                    {{ 'contactorFirstname' | i18n }}
                  </nz-form-label>
                  <nz-form-control [nzSpan]="16" nzHasFeedback nzErrorTip="{{ 'error.form.field.required' | i18n }}">
                    <input nz-input [(ngModel)]="currentEasyPostConfiguration!.contactorFirstname" />
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col [nzSpan]="8">
                <nz-form-item nzFlex>
                  <nz-form-label [nzSpan]="8">
                    {{ 'contactorLastname' | i18n }}
                  </nz-form-label>
                  <nz-form-control [nzSpan]="16" nzHasFeedback nzErrorTip="{{ 'error.form.field.required' | i18n }}">
                    <input nz-input [(ngModel)]="currentEasyPostConfiguration!.contactorLastname" />
                  </nz-form-control>
                </nz-form-item>
              </div>
            </div>
            <div nz-col [nzSpan]="24">
              <nz-form-item nzFlex>
                <nz-form-label [nzSpan]="2">
                  {{ 'shipFromAddress' | i18n }}
                </nz-form-label>
                <nz-form-control [nzSpan]="18">
                  <!--
                    
                  <input nz-input ngx-google-places-autocomplete (onAddressChange)="handleShipFromAddressChange($event)" />
                  -->
                  <input nz-input  />
                </nz-form-control>
              </nz-form-item>
            </div> 
  
        </nz-card>
        <div nz-row [nzGutter]="24"> 
          <div nz-col [nzSpan]="12">
            <nz-form-item>
                <nz-form-label [nzSpan]="10">
                {{ 'useWarehouseAddressAsReturnFlag' | i18n }}
                </nz-form-label>
                <nz-form-control [nzSpan]="14"> 

                    <label nz-checkbox [(ngModel)]="currentEasyPostConfiguration!.useWarehouseAddressAsReturnFlag"></label>
                </nz-form-control>
            </nz-form-item>
          </div>   
        </div>
        <!--If not use the warehouse's address, allow the user to type in a adddress that will show up in the parcel label -->
        <nz-card *ngIf="!currentEasyPostConfiguration!.useWarehouseAddressAsReturnFlag" nzTitle="{{'returnAddress' | i18n}}">
 
          
            <div nz-row [nzGutter]="24">
              <div nz-col [nzSpan]="8">
                <nz-form-item nzFlex>
                  <nz-form-label [nzSpan]="8">
                    {{ 'contactorFirstname' | i18n }}
                  </nz-form-label>
                  <nz-form-control [nzSpan]="16" nzHasFeedback nzErrorTip="{{ 'error.form.field.required' | i18n }}">
                    <input nz-input [(ngModel)]="currentEasyPostConfiguration!.returnContactorFirstname" />
                  </nz-form-control>
                </nz-form-item>
              </div><div nz-col [nzSpan]="8">
                <nz-form-item nzFlex>
                  <nz-form-label [nzSpan]="8">
                    {{ 'contactorLastname' | i18n }}
                  </nz-form-label>
                  <nz-form-control [nzSpan]="16" nzHasFeedback nzErrorTip="{{ 'error.form.field.required' | i18n }}">
                    <input nz-input [(ngModel)]="currentEasyPostConfiguration!.returnContactorLastname" />
                  </nz-form-control>
                </nz-form-item>
              </div>
            </div>
            <div nz-col [nzSpan]="24">
              <nz-form-item nzFlex>
                <nz-form-label [nzSpan]="2">
                  {{ 'returnAddress' | i18n }}
                </nz-form-label>
                <nz-form-control [nzSpan]="18">
                  <!--
                    
                  <input nz-input ngx-google-places-autocomplete (onAddressChange)="handleReturnAddressChange($event)" />
                  -->
                  <input nz-input />
                </nz-form-control>
              </nz-form-item>
            </div> 
        </nz-card>
        <ng-template #actionConfirm>
            <div nz-row nzJustify="start" style="padding: 15px;" nzAlign="middle">
                <button nz-button nzType="primary" (click)="confirm()" >
                    <span> {{ 'confirm' | i18n }}</span>
                  </button>
            </div>
          </ng-template>
    
    </nz-card>
    <nz-card [nzActions]="[actionAddCarrier]" nzTitle="{{'carrier' | i18n}}">        
        <div *ngIf="currentEasyPostConfiguration.carriers == null || currentEasyPostConfiguration.carriers.length == 0">
            <strong>{{'no-easy-post-carrier-setup' | i18n}}</strong>
        </div>
        
        <div class="search-result-list"> 
          
          <st #st [data]="currentEasyPostConfiguration.carriers" [columns]="columns" >
            <ng-template st-row="actionColumn" let-item let-index="index"> 
              
              <button nz-button nzDanger="true" (click)="removeCarrier(item)">
                  {{ 'remove' | i18n }}  </button> 
            </ng-template>
          </st>
        
        </div>
        <!--
          
        <nz-list *ngIf="currentEasyPostConfiguration.carriers && currentEasyPostConfiguration.carriers.length > 0">
            <nz-list-item *ngFor="let carrier of currentEasyPostConfiguration.carriers">
              <ng-container > 
                <nz-list-item-meta>                    
                  <nz-list-item-meta-title>
                    <a>{{carrier.carrier?.name}}</a>
                  </nz-list-item-meta-title>
                  <nz-list-item-meta-description>
                   {{ 'accountNumber' | i18n}}: {{ carrier.accountNumber  }}
                  </nz-list-item-meta-description> 
                </nz-list-item-meta>
                <ul nz-list-item-actions>
                  <nz-list-item-action><a (click)="removeCarrier(carrier)">{{'remove' | i18n}}</a></nz-list-item-action> 
                </ul>
              </ng-container> 
            </nz-list-item> 
          </nz-list>
          
        -->
          <ng-template #actionAddCarrier>
              <div nz-row nzJustify="start" style="padding: 15px;" nzAlign="middle">
                  <button nz-button nzType="primary" (click)="openAddCarrierModal(tplAddCarrierModalTitle, tplAddCarrierModalContent)" >
                      <span> {{ 'add' | i18n }}</span>
                    </button>
              </div>
            </ng-template>
    </nz-card>

</nz-spin>


<!-- Modal for add carrier -->
<ng-template #tplAddCarrierModalTitle>
    <span>{{ 'Add' | i18n}}</span>
  </ng-template>
  <ng-template #tplAddCarrierModalContent>
    <form nz-form [formGroup]="addCarrierForm">
      <div nz-row [nzGutter]="24">
        <div nz-col [nzSpan]="12">
          <nz-form-item nzFlex>
            <nz-form-label [nzSpan]="6" nzFor="carrier">
              {{ 'carrier' | i18n }}
            </nz-form-label>
            <nz-form-control [nzSpan]="18">
              <nz-input-group nzSize="large"> 
                <nz-select formControlName="carrier" nzAllowClear style="width: 150px" >
                    <nz-option *ngFor="let carrier of avaiableCarriers" [nzValue]="carrier.id" [nzLabel]="carrier.description!"></nz-option>
                  </nz-select>
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
        
      <div nz-row [nzGutter]="24">
        <div nz-col [nzSpan]="12">
          <nz-form-item nzFlex>
            <nz-form-label [nzSpan]="6" nzFor="accountNumber">
              {{ 'accountNumber' | i18n }}
            </nz-form-label>
            <nz-form-control [nzSpan]="18">
              <nz-input-group nzSize="large">
                <input nz-input formControlName="accountNumber" />
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div> 
      </div> 
      <div nz-row [nzGutter]="24">

      
        <div nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-label [nzSpan]="6">
              {{ 'report.type' | i18n }}
            </nz-form-label>
            <nz-form-control [nzSpan]="18">
              <nz-select nzAllowClear formControlName="type" style="width: 300px;">
                <nz-option *ngFor="let reportType of reportTypes | keys" nzValue="{{ reportType.key }}"
                  nzLabel="{{ 'REPORT-TYPE-' + reportType.key | i18n }}">
                </nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
      <div nz-row [nzGutter]="24">
        <div nz-col [nzSpan]="12">
          <nz-form-item nzFlex>
            <nz-form-label [nzSpan]="6" nzFor="printerName">
              {{ 'printer' | i18n }}
            </nz-form-label>
            <nz-form-control [nzSpan]="18">
              <nz-input-group nzSize="large">
                <nz-select nzAllowClear formControlName="printerName" style="width: 300px;">
                  <nz-option *ngFor="let printer of printers" [nzValue]="printer.name"
                  [nzLabel]="printer.name">
                  </nz-option>
                </nz-select>
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div> 
      </div> 
      
      <div nz-row [nzGutter]="24">
        <div nz-col [nzSpan]="8">
          <nz-form-item>
              <nz-form-label [nzSpan]="22">
              {{ 'printParcelLabelAfterManifest' | i18n }}
              </nz-form-label>
              <nz-form-control [nzSpan]="2"> 
                  <label nz-checkbox formControlName="printParcelLabelAfterManifest"></label>

              </nz-form-control>
          </nz-form-item>
        </div>   
        <div nz-col [nzSpan]="8">
          <nz-form-item>
              <nz-form-label [nzSpan]="10">
              {{ 'labelCopyCount' | i18n }}
              </nz-form-label>
              <nz-form-control [nzSpan]="14"> 
                <nz-input-number
                  formControlName="labelCopyCount"
                  [nzMin]="1"
                  [nzMax]="99"
                  [nzStep]="1" 
                ></nz-input-number> 
              </nz-form-control>
          </nz-form-item>
        </div>   
      </div>   
        
      <div nz-row [nzGutter]="24">
        <div nz-col [nzSpan]="8">
          <nz-form-item>
              <nz-form-label [nzSpan]="22">
              {{ 'schedulePickupAfterManifest' | i18n }}
              </nz-form-label>
              <nz-form-control [nzSpan]="2"> 
                  <label nz-checkbox formControlName="schedulePickupAfterManifest"></label>

              </nz-form-control>
          </nz-form-item>
        </div>   
        <div nz-col [nzSpan]="8">
          <nz-form-item>
              <nz-form-label [nzSpan]="12">
              {{ 'minPickupTime' | i18n }}
              </nz-form-label>
              <nz-form-control [nzSpan]="12"> 
                <nz-time-picker formControlName="minPickupTime" nzFormat="HH:mm"></nz-time-picker>

              </nz-form-control>
          </nz-form-item>
        </div>   
        <div nz-col [nzSpan]="8">
          <nz-form-item>
              <nz-form-label [nzSpan]="12">
              {{ 'maxPickupTime' | i18n }}
              </nz-form-label>
              <nz-form-control [nzSpan]="12"> 
                <nz-time-picker formControlName="maxPickupTime" nzFormat="HH:mm"></nz-time-picker>

              </nz-form-control>
          </nz-form-item>
        </div>   
      </div>

    </form>

  </ng-template>