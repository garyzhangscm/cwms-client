<page-header title="{{'light-mes-status-dashboard' |  i18n}}" ></page-header>




<nz-spin [nzSpinning]="isSpinning" [nzSize]="'large'">

  <div *ngIf="lightMESConfiguration == null">

    <nz-result nzStatus="warning" [nzIcon]="'info-circle'" nzTitle="{{'light MES Configuration is not setup' | i18n}}"> 
      <div nz-result-extra>
        please go to <a routerLink="/work-order/light-mes-configuration" routerLinkActive="active">Light MES Configuration</a> page to setup the configuration
      </div>
    </nz-result>
  </div>


  <nz-card  *ngIf="lightMESConfiguration != null" [nzExtra]="showConfigurationTemplate"
       nzTitle="Count down: {{ countDownNumber }}">
       
    <ng-template #showConfigurationTemplate>
      
        <span style="padding-right: 10px">Hours Spend on this shift: 
          <strong>{{hoursSpentInThisShift | number: '1.0-2'}}</strong>
        </span>
        <span style="padding-right: 10px">current time: 
            <strong>{{currentTime}}</strong></span>

            <span style="padding-right: 10px">(current shift: 
              <strong>[{{currentShiftStartTime }} - {{currentShiftEndTime  }}]</strong>)</span>
        <label nz-checkbox [(ngModel)]="showConfiguration" >
          <span> {{ 'showConfiguration' | i18n }}</span>
        </label>
    </ng-template>
    <div *ngIf="showConfiguration" style="padding: 10px">
        {{'type' | i18n}}: <nz-radio-group [(ngModel)]="productionLineType" (ngModelChange)="productionLineTypeChanged()">
          <label nz-radio nzValue="All">All</label>
          <label nz-radio *ngFor="let type of productionLineTypes" [nzValue]="type.name">{{type.name}}</label> 
        </nz-radio-group>
        
        <span style="padding-left: 20px">Refresh Cycle(in seconds): </span>
        <nz-input-number   [nzMin]="1" [nzMax]="9999" [nzStep]="1"   [(ngModel)]="refreshCountCycle" (ngModelChange)="refreshCountCycleChanged()" >
        </nz-input-number> 

    </div>  
    <!--

      <div nz-card-grid [ngStyle]="gridStyle" *ngFor="let machine of machines"  >
      </div>
      
    -->
    <div nz-card-grid [ngStyle]="gridStyle" *ngFor="let machine of machines"  >
      <nz-card [nzBodyStyle]="getBodyStyle(machine)" >
          <div style="font-size: 20px;">{{machine.machineNo}}</div>
          <div *ngFor="let machineStatistics of machine.machineStatistics">
            <div *ngIf="machineStatistics.active">
              <div style="font-size: 15px;">{{machineStatistics.itemName}}</div>
              <div style="text-decoration:underline;">{{machineStatistics.producedQuantity}} / {{machineStatistics.estimationQuantity}} ({{machineStatistics.achievementRate | percent: '1.0-2'}})</div>
          
            </div>
            <div *ngIf="!machineStatistics.active">
              <div style="font-size: 15px; color: grey">{{machineStatistics.itemName}}</div>
              <div  style="color: grey; text-decoration:underline;">{{machineStatistics.producedQuantity}} / {{machineStatistics.estimationQuantity}} ({{machineStatistics.achievementRate | percent: '1.0-2'}})</div>
          
            </div>
            </div>
          <div *ngIf="machine.machineStatistics == null || machine.machineStatistics.length == 0">
            <div style="font-size: 15px;">N/A</div>
            <div>0 / 0 (0%)</div>
          
          </div>
          <!--

          <p>mold count: {{machine.lastHourPulseCount}} / {{machine.shiftPulseCount}}</p>
          <p>cycle time: {{machine.lastHourCycleTime}} / {{machine.shiftCycleTime}}</p>
          -->
          <div>mold count:  {{machine.pulseCount}}</div>
          <div>cycle time: {{machine.lastTimeWindowCycleTime}}</div>
          <ng-template #titleTemplate>
            <strong [ngStyle]="getBodyStyle(machine)">{{machine.machineNo}}</strong>
          </ng-template>
      </nz-card>
    </div>  
  </nz-card>
</nz-spin>